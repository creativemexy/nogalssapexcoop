"use strict";(()=>{var e={};e.id=999,e.ids=[999],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{e.exports=require("async_hooks")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},63757:e=>{e.exports=import("prettier/plugins/html")},45747:e=>{e.exports=import("prettier/standalone")},84492:e=>{e.exports=require("node:stream")},25806:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>O,patchFetch:()=>U,requestAsyncStorage:()=>j,routeModule:()=>C,serverHooks:()=>I,staticGenerationAsyncStorage:()=>q});var n={};r.r(n),r.d(n,{GET:()=>P});var s=r(49303),i=r(88716),a=r(60670),o=r(87070),d=r(13538),l=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,y=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&y(e,r,t[r]);if(h)for(var r of h(t))m.call(t,r)&&y(e,r,t[r]);return e},g=(e,t)=>c(e,u(t)),v=(e,t,r)=>new Promise((n,s)=>{var i=e=>{try{o(r.next(e))}catch(e){s(e)}},a=e=>{try{o(r.throw(e))}catch(e){s(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(e,t)).next())}),b=class{constructor(e){this.resend=e}create(e){return v(this,arguments,function*(e,t={}){return yield this.resend.post("/api-keys",e,t)})}list(){return v(this,null,function*(){return yield this.resend.get("/api-keys")})}remove(e){return v(this,null,function*(){return yield this.resend.delete(`/api-keys/${e}`)})}},x=class{constructor(e){this.resend=e}create(e){return v(this,arguments,function*(e,t={}){return yield this.resend.post("/audiences",e,t)})}list(){return v(this,null,function*(){return yield this.resend.get("/audiences")})}get(e){return v(this,null,function*(){return yield this.resend.get(`/audiences/${e}`)})}remove(e){return v(this,null,function*(){return yield this.resend.delete(`/audiences/${e}`)})}};function w(e){return{attachments:e.attachments,bcc:e.bcc,cc:e.cc,from:e.from,headers:e.headers,html:e.html,reply_to:e.replyTo,scheduled_at:e.scheduledAt,subject:e.subject,tags:e.tags,text:e.text,to:e.to}}var S=class{constructor(e){this.resend=e}send(e){return v(this,arguments,function*(e,t={}){return this.create(e,t)})}create(e){return v(this,arguments,function*(e,t={}){let n=[];for(let t of e){if(t.react){if(!this.renderAsync)try{let{renderAsync:e}=yield r.e(7044).then(r.bind(r,97044));this.renderAsync=e}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}t.html=yield this.renderAsync(t.react),t.react=void 0}n.push(w(t))}return yield this.resend.post("/emails/batch",n,t)})}},_=class{constructor(e){this.resend=e}create(e){return v(this,arguments,function*(e,t={}){if(e.react){if(!this.renderAsync)try{let{renderAsync:e}=yield r.e(7044).then(r.bind(r,97044));this.renderAsync=e}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}e.html=yield this.renderAsync(e.react)}return yield this.resend.post("/broadcasts",{name:e.name,audience_id:e.audienceId,preview_text:e.previewText,from:e.from,html:e.html,reply_to:e.replyTo,subject:e.subject,text:e.text},t)})}send(e,t){return v(this,null,function*(){return yield this.resend.post(`/broadcasts/${e}/send`,{scheduled_at:null==t?void 0:t.scheduledAt})})}list(){return v(this,null,function*(){return yield this.resend.get("/broadcasts")})}get(e){return v(this,null,function*(){return yield this.resend.get(`/broadcasts/${e}`)})}remove(e){return v(this,null,function*(){return yield this.resend.delete(`/broadcasts/${e}`)})}update(e,t){return v(this,null,function*(){return yield this.resend.patch(`/broadcasts/${e}`,{name:t.name,audience_id:t.audienceId,from:t.from,html:t.html,text:t.text,subject:t.subject,reply_to:t.replyTo,preview_text:t.previewText})})}},E=class{constructor(e){this.resend=e}create(e){return v(this,arguments,function*(e,t={}){return yield this.resend.post(`/audiences/${e.audienceId}/contacts`,{unsubscribed:e.unsubscribed,email:e.email,first_name:e.firstName,last_name:e.lastName},t)})}list(e){return v(this,null,function*(){return yield this.resend.get(`/audiences/${e.audienceId}/contacts`)})}get(e){return v(this,null,function*(){return e.id||e.email?yield this.resend.get(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}update(e){return v(this,null,function*(){return e.id||e.email?yield this.resend.patch(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`,{unsubscribed:e.unsubscribed,first_name:e.firstName,last_name:e.lastName}):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}remove(e){return v(this,null,function*(){return e.id||e.email?yield this.resend.delete(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}},N=class{constructor(e){this.resend=e}create(e){return v(this,arguments,function*(e,t={}){return yield this.resend.post("/domains",{name:e.name,region:e.region,custom_return_path:e.customReturnPath},t)})}list(){return v(this,null,function*(){return yield this.resend.get("/domains")})}get(e){return v(this,null,function*(){return yield this.resend.get(`/domains/${e}`)})}update(e){return v(this,null,function*(){return yield this.resend.patch(`/domains/${e.id}`,{click_tracking:e.clickTracking,open_tracking:e.openTracking,tls:e.tls})})}remove(e){return v(this,null,function*(){return yield this.resend.delete(`/domains/${e}`)})}verify(e){return v(this,null,function*(){return yield this.resend.post(`/domains/${e}/verify`)})}},$=class{constructor(e){this.resend=e}send(e){return v(this,arguments,function*(e,t={}){return this.create(e,t)})}create(e){return v(this,arguments,function*(e,t={}){if(e.react){if(!this.renderAsync)try{let{renderAsync:e}=yield r.e(7044).then(r.bind(r,97044));this.renderAsync=e}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}e.html=yield this.renderAsync(e.react)}return yield this.resend.post("/emails",w(e),t)})}get(e){return v(this,null,function*(){return yield this.resend.get(`/emails/${e}`)})}update(e){return v(this,null,function*(){return yield this.resend.patch(`/emails/${e.id}`,{scheduled_at:e.scheduledAt})})}cancel(e){return v(this,null,function*(){return yield this.resend.post(`/emails/${e}/cancel`)})}},A="undefined"!=typeof process&&process.env&&process.env.RESEND_BASE_URL||"https://api.resend.com",R="undefined"!=typeof process&&process.env&&process.env.RESEND_USER_AGENT||"resend-node:4.6.0";let T=new class{constructor(e){if(this.key=e,this.apiKeys=new b(this),this.audiences=new x(this),this.batch=new S(this),this.broadcasts=new _(this),this.contacts=new E(this),this.domains=new N(this),this.emails=new $(this),!e&&("undefined"!=typeof process&&process.env&&(this.key=process.env.RESEND_API_KEY),!this.key))throw Error('Missing API key. Pass it to the constructor `new Resend("re_123")`');this.headers=new Headers({Authorization:`Bearer ${this.key}`,"User-Agent":R,"Content-Type":"application/json"})}fetchRequest(e){return v(this,arguments,function*(e,t={}){try{let r=yield fetch(`${A}${e}`,t);if(!r.ok)try{let e=yield r.text();return{data:null,error:JSON.parse(e)}}catch(t){if(t instanceof SyntaxError)return{data:null,error:{name:"application_error",message:"Internal server error. We are unable to process your request right now, please try again later."}};let e={message:r.statusText,name:"application_error"};if(t instanceof Error)return{data:null,error:g(f({},e),{message:t.message})};return{data:null,error:e}}return{data:yield r.json(),error:null}}catch(e){return{data:null,error:{name:"application_error",message:"Unable to fetch data. The request could not be resolved."}}}})}post(e,t){return v(this,arguments,function*(e,t,r={}){let n=new Headers(this.headers);r.idempotencyKey&&n.set("Idempotency-Key",r.idempotencyKey);let s=f({method:"POST",headers:n,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)})}get(e){return v(this,arguments,function*(e,t={}){let r=f({method:"GET",headers:this.headers},t);return this.fetchRequest(e,r)})}put(e,t){return v(this,arguments,function*(e,t,r={}){let n=f({method:"PUT",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}patch(e,t){return v(this,arguments,function*(e,t,r={}){let n=f({method:"PATCH",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}delete(e,t){return v(this,null,function*(){let r={method:"DELETE",headers:this.headers,body:JSON.stringify(t)};return this.fetchRequest(e,r)})}}(process.env.RESEND_API_KEY);class k{static async sendEmail({to:e,subject:t,html:r}){try{let{data:n,error:s}=await T.emails.send({from:"Nogalss <noreply@nogalss.com>",to:[e],subject:t,html:r});if(s)throw console.error("Email sending error:",s),Error("Failed to send email");return n}catch(e){throw console.error("Email notification error:",e),e}}static async sendSMS({to:e,message:t}){try{let r=process.env.TWILIO_ACCOUNT_SID,n=process.env.TWILIO_AUTH_TOKEN,s=process.env.TWILIO_PHONE_NUMBER;if(!r||!n||!s)throw Error("Twilio credentials not configured");let i=await fetch(`https://api.twilio.com/2010-04-01/Accounts/${r}/Messages.json`,{method:"POST",headers:{Authorization:`Basic ${btoa(`${r}:${n}`)}`,"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({To:e,From:s,Body:t})});if(!i.ok)throw Error("Failed to send SMS");return await i.json()}catch(e){throw console.error("SMS notification error:",e),e}}static async sendPaymentConfirmationEmail(e,t,r,n,s){let i=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: linear-gradient(135deg, #fb923c, #3b82f6); padding: 20px; text-align: center;">
          <h1 style="color: white; margin: 0;">Nogalss Cooperative</h1>
        </div>
        
        <div style="padding: 20px; background: #f9fafb;">
          <h2 style="color: #1f2937;">Payment Confirmation</h2>
          
          <p>Dear ${t},</p>
          
          <p>Your payment has been successfully processed.</p>
          
          <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="color: #1f2937; margin-top: 0;">Payment Details</h3>
            <table style="width: 100%;">
              <tr>
                <td style="padding: 8px 0;"><strong>Amount:</strong></td>
                <td style="padding: 8px 0;">₦${r.toLocaleString()}</td>
              </tr>
              <tr>
                <td style="padding: 8px 0;"><strong>Type:</strong></td>
                <td style="padding: 8px 0;">${s}</td>
              </tr>
              <tr>
                <td style="padding: 8px 0;"><strong>Reference:</strong></td>
                <td style="padding: 8px 0;">${n}</td>
              </tr>
              <tr>
                <td style="padding: 8px 0;"><strong>Date:</strong></td>
                <td style="padding: 8px 0;">${new Date().toLocaleDateString()}</td>
              </tr>
            </table>
          </div>
          
          <p>Thank you for your payment. If you have any questions, please contact our support team.</p>
          
          <p>Best regards,<br>Nogalss National Apex Cooperative Society Ltd</p>
        </div>
        
        <div style="background: #1f2937; color: white; padding: 20px; text-align: center;">
          <p style="margin: 0;">\xa9 2024 Nogalss Cooperative. All rights reserved.</p>
        </div>
      </div>
    `;return this.sendEmail({to:e,subject:"Payment Confirmation - Nogalss Cooperative",html:i})}static async sendRegistrationConfirmationEmail(e,t,r){let n=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: linear-gradient(135deg, #fb923c, #3b82f6); padding: 20px; text-align: center;">
          <h1 style="color: white; margin: 0;">Welcome to Nogalss</h1>
        </div>
        
        <div style="padding: 20px; background: #f9fafb;">
          <h2 style="color: #1f2937;">Registration Successful</h2>
          
          <p>Dear ${t},</p>
          
          <p>Welcome to Nogalss National Apex Cooperative Society Ltd! Your registration as a ${r} has been completed successfully.</p>
          
          <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="color: #1f2937; margin-top: 0;">Next Steps</h3>
            <ul style="color: #374151;">
              <li>Sign in to your account</li>
              <li>Complete your profile</li>
              <li>Explore our services</li>
              <li>Connect with other members</li>
            </ul>
          </div>
          
          <p>We're excited to have you as part of our cooperative community!</p>
          
          <p>Best regards,<br>Nogalss National Apex Cooperative Society Ltd</p>
        </div>
        
        <div style="background: #1f2937; color: white; padding: 20px; text-align: center;">
          <p style="margin: 0;">\xa9 2024 Nogalss Cooperative. All rights reserved.</p>
        </div>
      </div>
    `;return this.sendEmail({to:e,subject:"Welcome to Nogalss Cooperative",html:n})}static async sendPaymentConfirmationSMS(e,t,r){let n=`Nogalss: Your payment of ₦${t.toLocaleString()} has been confirmed. Ref: ${r}. Thank you!`;return this.sendSMS({to:e,message:n})}static async sendRegistrationConfirmationSMS(e,t){let r=`Nogalss: Welcome! Your ${t} registration is complete. Sign in to access your account.`;return this.sendSMS({to:e,message:r})}}async function P(e){try{let{searchParams:t}=new URL(e.url),r=t.get("reference");if(!r)return o.NextResponse.json({error:"Reference is required"},{status:400});let n=await fetch(`https://api.paystack.co/transaction/verify/${r}`,{headers:{Authorization:`Bearer ${process.env.PAYSTACK_SECRET_KEY}`}}),s=await n.json();if(!n.ok)return o.NextResponse.json({error:"Payment verification failed"},{status:400});let i=await d._.payment.findUnique({where:{paystackReference:r},include:{transaction:!0,user:!0}});if(!i)return o.NextResponse.json({error:"Payment not found"},{status:404});let a="success"===s.data.status?"SUCCESSFUL":"FAILED";if(await d._.$transaction([d._.payment.update({where:{id:i.id},data:{status:a,metadata:s.data}}),d._.transaction.update({where:{id:i.transactionId},data:{status:a}})]),"SUCCESSFUL"===a)try{let e=`${i.user.firstName} ${i.user.lastName}`;await k.sendPaymentConfirmationEmail(i.user.email,e,Number(i.amount),r,i.transaction.type),i.user.phoneNumber&&await k.sendPaymentConfirmationSMS(i.user.phoneNumber,Number(i.amount),r)}catch(e){console.error("Notification error:",e)}let l="SUCCESSFUL"===a?`${process.env.NEXTAUTH_URL}/payments/success?reference=${r}`:`${process.env.NEXTAUTH_URL}/payments/failed?reference=${r}`;return o.NextResponse.redirect(l)}catch(e){return console.error("Payment verification error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let C=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/payments/verify/route",pathname:"/api/payments/verify",filename:"route",bundlePath:"app/api/payments/verify/route"},resolvedPagePath:"/home/mexy/Desktop/newNogalss/src/app/api/payments/verify/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:j,staticGenerationAsyncStorage:q,serverHooks:I}=C,O="/api/payments/verify/route";function U(){return(0,a.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:q})}},13538:(e,t,r)=>{r.d(t,{_:()=>s});var n=r(53524);let s=globalThis.prisma??new n.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972],()=>r(25806));module.exports=n})();