"use strict";(()=>{var e={};e.id=1004,e.ids=[1004],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},7141:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var r={};a.r(r),a.d(r,{POST:()=>c});var n=a(49303),o=a(88716),s=a(60670),i=a(87070),p=a(13538),u=a(84770),d=a.n(u);async function c(e){try{let t=await e.text(),a=e.headers.get("x-paystack-signature");if(d().createHmac("sha512",process.env.PAYSTACK_SECRET_KEY).update(t).digest("hex")!==a)return i.NextResponse.json({error:"Invalid signature"},{status:401});let r=JSON.parse(t);if("charge.success"===r.event){let{reference:e,metadata:t}=r.data,a=await p._.payment.findUnique({where:{paystackReference:e},include:{transaction:!0}});a&&(await p._.$transaction([p._.payment.update({where:{id:a.id},data:{status:"SUCCESSFUL",metadata:r.data}}),p._.transaction.update({where:{id:a.transactionId},data:{status:"SUCCESSFUL"}})]),"CONTRIBUTION"===a.transaction.type&&await p._.contribution.create({data:{userId:a.userId,cooperativeId:a.cooperativeId,amount:a.amount,description:a.transaction.description||"Contribution payment"}}))}return i.NextResponse.json({received:!0})}catch(e){return console.error("Webhook error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/payments/webhook/route",pathname:"/api/payments/webhook",filename:"route",bundlePath:"app/api/payments/webhook/route"},resolvedPagePath:"/home/mexy/Desktop/newNogalss/src/app/api/payments/webhook/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:x}=m,v="/api/payments/webhook/route";function y(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},13538:(e,t,a)=>{a.d(t,{_:()=>n});var r=a(53524);let n=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>a(7141));module.exports=r})();