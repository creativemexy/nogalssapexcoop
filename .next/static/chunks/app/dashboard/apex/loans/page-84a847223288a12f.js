(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[609],{6994:function(e,t,s){Promise.resolve().then(s.bind(s,5673))},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var a=s(2972),r=s.n(a)},5673:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var a=s(7437),r=s(2265),l=s(7648);function n(){let[e,t]=(0,r.useState)(""),[s,n]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[u,g]=(0,r.useState)("ALL");(0,r.useEffect)(()=>{j()},[]);let j=async()=>{c(!0),o(null);try{let e=await fetch("/api/apex/loans");if(!e.ok)throw Error("Failed to fetch loans");let t=await e.json();n(t.loans||[])}catch(e){o(e.message||"Unknown error")}finally{c(!1)}},y=e=>{p(e),m(!0)},N=async e=>{if(confirm("Are you sure you want to approve the loan for ".concat(e.borrowerName,"?")))try{(await fetch("/api/apex/loans/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"APPROVED"})})).ok&&n(t=>t.map(t=>t.id===e.id?{...t,status:"APPROVED",approvedAt:new Date().toISOString()}:t))}catch(e){console.error("Failed to approve loan:",e)}},f=async e=>{if(confirm("Are you sure you want to reject the loan for ".concat(e.borrowerName,"?")))try{(await fetch("/api/apex/loans/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"REJECTED"})})).ok&&n(t=>t.map(t=>t.id===e.id?{...t,status:"REJECTED"}:t))}catch(e){console.error("Failed to reject loan:",e)}},w=e=>{switch(e){case"PENDING":return"bg-yellow-100 text-yellow-800";case"APPROVED":return"bg-green-100 text-green-800";case"REJECTED":return"bg-red-100 text-red-800";case"ACTIVE":return"bg-blue-100 text-blue-800";case"COMPLETED":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-500"}},b=s.filter(t=>{let s=t.borrowerName.toLowerCase().includes(e.toLowerCase())||t.borrowerEmail.toLowerCase().includes(e.toLowerCase())||t.cooperative.toLowerCase().includes(e.toLowerCase())||t.purpose.toLowerCase().includes(e.toLowerCase()),a="ALL"===u||t.status===u;return s&&a});return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loans Management"}),(0,a.jsx)(l.default,{href:"/dashboard/apex",className:"text-[#0D5E42] hover:text-[#0A4A35]",children:"← Back to Apex Dashboard"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search loans...",value:e,onChange:e=>t(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 w-full max-w-xs focus:outline-none focus:ring-2 focus:ring-[#0D5E42]"}),(0,a.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0D5E42]",children:[(0,a.jsx)("option",{value:"ALL",children:"All Status"}),(0,a.jsx)("option",{value:"PENDING",children:"Pending"}),(0,a.jsx)("option",{value:"APPROVED",children:"Approved"}),(0,a.jsx)("option",{value:"REJECTED",children:"Rejected"}),(0,a.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,a.jsx)("option",{value:"COMPLETED",children:"Completed"})]})]}),(0,a.jsx)("button",{className:"ml-4 bg-[#0D5E42] text-white px-6 py-2 rounded hover:bg-[#0A4A35]",onClick:()=>{},children:"+ Add New Loan"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Total Loans"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:s.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Pending"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(e=>"PENDING"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Approved"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s.filter(e=>"APPROVED"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s.filter(e=>"ACTIVE"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600",children:"Total Amount"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["₦",s.reduce((e,t)=>e+t.amount,0).toLocaleString()]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:i?(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):d?(0,a.jsx)("div",{className:"p-8 text-center text-red-500",children:d}):(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Borrower"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cooperative"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Purpose"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Interest Rate"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===b.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-500",children:"No loans found."})}):b.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.borrowerName}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.borrowerEmail})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:e.cooperative}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:["₦",e.amount.toLocaleString()]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:e.purpose}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:[e.interestRate,"%"]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:[e.duration," months"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(w(e.status)),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap space-x-2",children:[(0,a.jsx)("button",{className:"text-blue-600 hover:underline",onClick:()=>y(e),children:"View"}),"PENDING"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"text-green-600 hover:underline",onClick:()=>N(e),children:"Approve"}),(0,a.jsx)("button",{className:"text-red-600 hover:underline",onClick:()=>f(e),children:"Reject"})]}),(0,a.jsx)("button",{className:"text-yellow-600 hover:underline",onClick:()=>{},children:"Edit"})]})]},e.id))})]})}),x&&h&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative",children:[(0,a.jsx)("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl",onClick:()=>m(!1),"aria-label":"Close",children:"\xd7"}),(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Loan Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Borrower"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:h.borrowerName}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:h.borrowerEmail})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Cooperative"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:h.cooperative})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,a.jsxs)("p",{className:"mt-1 text-gray-900",children:["₦",h.amount.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Purpose"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:h.purpose})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Interest Rate"}),(0,a.jsxs)("p",{className:"mt-1 text-gray-900",children:[h.interestRate,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Duration"}),(0,a.jsxs)("p",{className:"mt-1 text-gray-900",children:[h.duration," months"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(w(h.status)),children:h.status})]}),h.approvedBy&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Approved By"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:h.approvedBy})]}),h.approvedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Approved At"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:new Date(h.approvedAt).toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Created"}),(0,a.jsx)("p",{className:"mt-1 text-gray-900",children:new Date(h.createdAt).toLocaleString()})]})]})]})})]})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=6994)}),_N_E=e.O()}]);